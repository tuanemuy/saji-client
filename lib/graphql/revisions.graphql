mutation CreateRevision(
  $slice_id: bigint!
  $content: String!
  $min_created_at: timestamptz!
) {
  insert_revisions_one(object: { slice_id: $slice_id, content: $content }) {
    id
    created_at
    updated_at
    content
    slice_id
  }

  delete_revisions(
    where: {
      _and: {
        slice_id: { _eq: $slice_id }
        updated_at: { _lt: $min_created_at }
      }
    }
  ) {
    returning {
      id
      content
      created_at
      updated_at
      slice_id
    }
  }
}

query GetRevisions($slice_id: bigint!, $limit: Int = 10) {
  revisions(
    limit: $limit
    order_by: { created_at: desc }
    where: { slice_id: { _eq: $slice_id } }
  ) {
    id
    content
    created_at
    updated_at
    slice_id
  }
}

mutation UpdateRevision($id: bigint!, $content: String!) {
  update_revisions_by_pk(pk_columns: { id: $id }, _set: { content: $content }) {
    id
    content
    created_at
    updated_at
    slice_id
  }
}

mutation DeleteRevisions($slice_id: bigint!, $min_created_at: timestamptz!) {
  delete_revisions(
    where: {
      _and: {
        slice_id: { _eq: $slice_id }
        updated_at: { _lt: $min_created_at }
      }
    }
  ) {
    returning {
      id
      content
      created_at
      updated_at
      slice_id
    }
  }
}
